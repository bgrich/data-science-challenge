\copy (SELECT DISTINCT ON (connector_referral.event_id) connector_referral.event  AS "connector_referral.event", lead.event  AS "lead.event", booking.event  AS "booking.event" FROM public.event  AS connector_referral LEFT JOIN public.attributed_to  AS attributed_to ON connector_referral.event_id = attributed_to.attributed_event_id AND (attributed_to.attribution_method = 'prefer-direct-ancestor-last-touch') LEFT JOIN public.event  AS lead ON attributed_to.event_id = lead.event_id AND lead.type IN ('api.lead', 'lead') LEFT JOIN public.lead_of  AS lead_of ON attributed_to.event_id = lead_of.lead_event_id AND attributed_to.event_type IN ('api.lead', 'lead') AND (lead_of.find_lead_method = 'prefer-direct-ancestor-last-lead') LEFT JOIN public.event  AS booking ON lead_of.event_id = booking.event_id AND booking.type = 'api.booking' WHERE ((((connector_referral.ts ) >= ((TIMESTAMP '2017-10-15' AT TIME ZONE 'America/New_York')) AND (connector_referral.ts ) < ((TIMESTAMP '2017-10-21' AT TIME ZONE 'America/New_York'))))) AND (connector_referral.type IN ('api.referral', 'referral') AND connector_referral.event ->> 'referral-method' = 'connector')) TO '/home/shewitt/data/challenge-raw.tsv' WITH CSV DELIMITER E'\t' QUOTE E'\b' NULL AS ''
